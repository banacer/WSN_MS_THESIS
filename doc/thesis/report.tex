\documentclass[oneside,12pt,a4paper,final]{book}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{setspace}
\usepackage{arabtex}
\usepackage{utf8}
\newcommand{\HRule}{\rule{\linewidth}{0.6mm}}
%\usepackage{hyperref}
\usepackage[acronym]{glossaries} 
\makeglossaries
\author{Nacer Khalil}
\title{Internet of Things: a Real-World Deployment Towards Smart Grids Integration}

\newenvironment{dedication}{\vspace{6ex}\begin{quotation}\begin{center}\begin{em}}{\par\end{em}\end{center}\end{quotation}}

    
\begin{document}
\doublespacing
\input{acronym}
\frontmatter

%COVER PAGE
\input{cover_page}
\chapter{} % dedications chapter
\begin{dedication}
To my dear parents for their patience, love and support \\
To my brothers Hossein, Omar and Saad \\
To my cousin Sara and her family \\
To my family \\
To my friends \\

\end{dedication}
\chapter{Acknowledgments}
\paragraph{}
I am deeply thankful to my supervisor Dr. Mohamed Riduan Abid for his very close supervision, guidance and for the advice he kept giving me during the lifetime of the project. Your advices whether they are computer science related, or even every day life related wise words things I will never forget.
\paragraph*{}
I am also thankful for having Dr. Driss Benhaddou as a supervisor. His advice, insight, guidance and very enlightening ideas. I wouldn't have been so interested in smart grids without the discussions we had on the topic.
\paragraph{}
I would also like to thank Dr. Michael Gerndt for his guidance in this thesis and also for his help and advising throughout my masters degree in Technische Universät München.
\paragraph{}
I  also thank Dr. Hamid Harroud who suggested several directions to take throughout the course of this project.
\paragraph{}
My special thanks to my close friends who helped relax in times that seemed very stressful. I wouldn't have made it without their help.
\paragraph{}
I also greatly thank all excellent professors of whom I had the chance to be a student. I learned things in class  I would have never learnt elsewhere.


\chapter{Abstract}
\paragraph{}
The information technology is advancing exponentially and is having bigger impact on our lives as time advances. The next revolution in computing is called the \gls{iot}. It is basically the internet we know nowadays except that physical objects (fridge, television, air conditioning...) will be the major players in this complex system. In this context, the project builds on this idea a test bed for smart home energy optimization. The project allows users to monitor their energy consumption via their smart phone and also the users can control their appliances by turning on and off appliances remotely.
\paragraph{}
The system is divided into three main components. Each of them is using different technologies such as \gls{tinyos}, \gls{nesc}, \gls{j2se}, \gls{http} and other technologies that will be discussed in the thesis report.
\paragraph{}
At this stage, the system allows monitoring, but turning on and off appliances is not yet there mainly because of the absence of the equipment but the communication for that purpose is there.

\chapter{Résumé}
\paragraph{}
La technologie de l'information progresse de façon exponentielle et son impact sur nos vies prend de l'importance plus le temps avance. La prochaine révolution de l'informatique est appelé \glsreset{iot} \gls{iot}. Il s'agit essentiellement de Internet tel que nous la connaissons aujourd'hui, sauf que les objets physiques  seront les principaux acteurs de ce système. Ainsi, le projet s'appuie sur cette idée et présente un prototype qui a pour but l'optimisation intelligente de l'énergie dans les domiciles. Le projet permet aux utilisateurs de suivre de près leur consommation d'énergie via leur smartphone et permet de contrôler leurs appareils en allumant et éteignant les appareils à distance.
\paragraph {}
Le système est divisé en trois composantes principales. Chacun d'entre eux  utilise différentes technologies telles que \gls{tinyos}, \gls{nesc}, \gls{j2se}, \gls{http} et d'autres technologies qui seront présentées dans le rapport de thèse.
\paragraph{}
A ce stade, le système permet de surveiller, mais controler les appareils n'est pas encore mise en place principalement en raison de l'absence de matériel, mais l'infrastructure de communication pour ce but là est en place.
\setcode{utf8}

%\chapter{ملخص}

\chapter{Arabic}
\paragraph{}
\begin{arabtex}
تكنولوجيا المعلومات تتقدم باطراد وجود أكبر تأثير على حياتنا كما تقدم الوقت. الثورة القادمة في مجال الحوسبة يسمى إنترنت الأشياء (قام المحفل). انها اساسا شبكة الانترنت ونحن نعلم في الوقت الحاضر إلا أن الأشياء المادية (ثلاجة، تلفزيون، تكييف هواء ...) وسوف تكون القوى الفاعلة الرئيسية في هذا النظام المعقد. وفي هذا السياق، فإن المشروع يبني على هذه الفكرة على سرير اختبار لترشيد استهلاك الطاقة الذكية الرئيسية. ال يسمح المشروع للمستخدمين لرصد استهلاك الطاقة لديها عبر الذكية الخاصة بهم الهاتف وأيضا يمكن للمستخدمين التحكم في الأجهزة عن طريق تشغيل وإيقاف الأجهزة عن بعد.
\end{arabtex}
\paragraph{}
\begin{arabtex}
وينقسم النظام إلى ثلاثة عناصر رئيسية. كل واحد منهم يستخدم
التكنولوجيات المختلفة، مث لTinyOS، NESC، ومعيار جافا
طبعة J2SE، بروتوكول نقل النص التشعبي HTTP وغيرها من التكنولوجيات
التي سيتم مناقشتها في التقرير أطروحة.
\end{arabtex}
\paragraph{}
\begin{arabtex}

في هذه المرحلة، ونظام مراقبة يسمح، ولكن تشغيل وإيقاف تطبيق صحيفة-
 ليس هناك حتى الآن وذلك أساسا بسبب غياب المعدات ولكن البلاغ لهذا الغرض هناك.
\end{arabtex}

\singlespacing

\tableofcontents
\listoffigures
\listoftables

\mainmatter
\doublespacing
\chapter{Introduction}

\section{Importance of study}
\paragraph{}
The global electrical grid one the bases that gives us this quality of life that most people around the world enjoy. The global electrical grid is sometimes called the largest machine ever made by man. \cite{ref1}. It a widespread machine, distributed but interconnected system that provides power to households, companies and other organizations and therefore the world's economy is counting on it. The electrical grid knows numerous problems such as blackouts, current instabilities that costs billions of dollars yearly to both the utilities, utilities and insurances. The grid suffers from the problem of peak hours where energy consumption where in many case the one single utility cannot provide such energy.
\paragraph{}
The \gls{sg} comes to provide solutions to the problems that suffers from the traditional electrical grid. \gls{sg} is an intelligent, auto-balancing, and self-monitoring electrical grid \cite{ref2} and is and whose energy sources are distributed between utilities and consumers. The nature of the \gls{sg} as having distributed energy sources reduces numerous losses that arises in the traditional grid such as the energy loss in the energy transmission lines and also in the overload of the electrical lines.
\paragraph{}
Another revolution is about to begin and it is taking place in the information technology and is called \glsreset{iot}\gls{iot}. \gls{iot} is the era of autonomous machine able to produce and consume information and being able to act autonomously without the guidance of humans to performs their tasks. Cisco predicts that the number of devices to be connected in 2020 will break the 50 billions devices \cite{ref3} whereas the world population will be around 7.6 billion. That make 6.58 devices connected for each person in the world whereas the number of devices connected in 2010 12.5 billion. This clearly shows that the shift to the \gls{iot} has already started.
\paragraph{}
\glsreset{sg}\gls{sg} can and will benefit from the \gls{iot}. The integration of the \gls{sg} and and \gls{iot} makes this study and thesis of high importance in order to solve as much as possible the problems of the traditional grid but at the same bring a new dimension to the power grid by benefiting from the numerous possibilities offered by the \gls{iot}.

\section{Rationale of study}
\paragraph{}
This project has been done in order to investigate ways the \gls{iot} can benefit the \gls{sg}. The smart grid as a set of philosophical ideas counts on a set of novel functionalities. Once of these ideas is the two-way communication that will make possible the utility to communicate with consumers and vice versa. This concept is possible with the Internet Of Things as devices in \gls{iot} communicate between them by producing and consuming information. Numerous ideas are based on this two-way communication such as the \gls{dr} which offers a set of services for both the power provider and the consumer.
\paragraph{}
The \glsreset{iot}\gls{iot} counts on different technologies such as \gls{wsn}, \gls{rfid}, \gls{ipv6} and other technologies which make the Internet of things a very heterogeneous and complex system \cite{ref4}. One of the challenges in \gls{iot} is to deals with such heterogeneity and take the most out of it in order to make the communication as smooth and robust as possible. This heterogeneity should be made transparent to any two parties trying to communicate in \gls{iot}.

\section{Problem statement}
\paragraph{}
The \glsreset{sg} \gls{sg} counts on the two-way communication to build to a whole communication and protocol stack namely the \glsreset{dr}\gls{dr} and other services built on top of the \gls{dr}. From the consumer's side or more precisely the household's side, there are smart home energy management software in the market nowadays but none of these products offers integration with \gls{sg}. To have such an integration with \gls{sg}, there is a need to first build this two-way communication and make it possible for any appliance to report its real-time energy consumption and also to be able to be controlled remotely with this two-way communication. Such infrastructure is missing for the time being and therefore the integration of the smart home within the smart grid is not possible. Also, in order for \gls{sg} to be integrated into the \gls{iot}, all devices should be able to communicate in the two directions.
\paragraph{}
As \gls{sg} counts on numerous technologies to achieve its main goals. This usage of different technologies imposes another problem which is the heterogeneity of the system. As numerous components count on different technologies, there is a need to interface them in order to make this heterogeneity transparent to the all components of the system. This means that there is a need to build a software within the whole system that would constitute an important part of it and will take care of making the communication and processes technology-transparent and give the possibility to all components of the system to work hand-in-hand in order their common goals independently of the data link layer technology (Ethernet, Wifi or Zigbee) they are counting on, the network layer technology (\gls{ipv4} or \gls{ipv6}).

\section{Purpose of study}
 \paragraph{}
The goal of the study is to solve the problems introduced in the problem statement section. This means creating the two-way communication, and also solving the heterogeneity that arises from integrating smart homes with the smart grid and making each components in the smart home as part of the Internet of things by making it communicate with any device in the Internet and having an \gls{ipv6} address that is built by making use of \gls{6lowpan} whose goal is to provide the TCP/IP to the smallest devices and with the least computational and energy rich.
\paragraph{}
The first purpose of this study is to create a testbed having the two-way communication and also being able to make use of it in order to build richer applications based on this possibility. To do it, there was a need to first introduce \gls{6lowpan} within every device in the \gls{wsn}. This would make every sensor node also known as mote identified and ready to communicate and be part of the \gls{iot}. This communication will go in the two directions and based on that the two-way communication will have to be built.
\paragraph{}
The second purpose of this study is to solve the heterogeneity problem that arises with the integration of smart homes within the smart grid and also when making the whole system as part of the \glsreset{iot}\gls{iot}. Solving such a problem means having an additional component that will track all communication packets and change them to fit the needs of the destination component. This will make of this additional component a middleman and therefore make the heterogeneity problem disappear.

\section{scope of study}
\paragraph{}
The thesis aims to solves the two problems presented in section 1.3. To do so, a variety of tools and technologies were used for this purpose.The two problems were not solved one independently of the other but even though the problems seem separate one cannot solve without having to solve the other. In other words, after the creation of the two-way communication in the \glsreset{wsn}\gls{wsn} which supported \gls{ipv6} over \gls{6lowpan}, other network only supported \gls{ipv4} and therefore could not communicate, and this was due to the heterogeneity problem. This is why the two-way communication was created and then the heterogeneity problem had to be solved in order to see everything working.
The system is divided into four components:
\begin{itemize}
\item The fully \gls{ipv6} supported \gls{wsn}
\item The \gls{tinyos} program for sensor transmission and appliance request handler
\item The heterogeneity handler and middleman gateway server
\item The mobile client
\end{itemize}
\paragraph{}
Each of these four component exist to solve part of the problem. Each of these components will be discussed extensively in the Chapter 4 from the architectural aspect of the component and in Chapter 5 from the implementation level of the system. 
\paragraph{}
It is to be noted that some of the concepts will be discussed from the architectural point in Chapter 4 but not from an implementation point in Chapter 5. The sole reason behind is the fact that some of the equipment required for this thesis did not arrive on time and therefore the parts in the implementation requiring such equipment was omitted to meet the deadlines.
\section{Outcome of the study}
\paragraph{}
The outcome of the thesis is to design and implement a test-bed that is able to show the two-way communication in action. It will also have to show concepts of the \glsreset{iot}\gls{iot} which are that every node in the system can communicate autonomously and with any other node in the Internet. Another \gls{iot} concept is the ability of any node in the \gls{iot} to consume and produce information that is communicated through the network.
\paragraph{}
The autonomous production of information is shown by the fact that every sensor node in the \gls{wsn} reads sensory data from its sensors that are attached to appliance in order to sense their consumption and this information is produced and transmitted periodically. The consumption of data by is shown by external nodes in the \gls{iot} sending request to the sensor node in the \gls{wsn} in order to control and appliance's status i.e. turn on the television. This will prove the consumption of information by the nodes in the \gls{iot}.
\paragraph{}
The test-bed should also show that communication between any two nodes in the \gls{iot} is successful, robust and reliable and that the heterogeneity of the system is made transparent to the nodes in the system by the creation of the software tool residing in the gateway which is between the \gls{iot} and the outside world. This software tool is seen as a heterogeneity handler and also a communication middleman that translates the communication to the appropriate technology needed by the recipient.
\paragraph{}
The testbed will able to show the two-way communication in action and will also show that the heterogeneity does not form a barrier by its successful handling.

\section{Outline of the Thesis}
\paragraph{}
The thesis is is divided into eight chapters. Each of the chapter approaches thesis from a different aspect. 
\paragraph{Chapter 1}
It is an introductory chapter that gives a flavor of the project that is to be studied in this thesis and also introduces the problem and the solution proposed in this topic. This chapter also puts the reader into perspective by introducing some of the main concepts related to the \glsreset{sg}\gls{sg} and the \glsreset{iot}\gls{iot}. 
\paragraph{Chapter 2}
It presents the background of the work by revising the literature related to the topics of \gls{iot} and \gls{sg}. It also discussed related work and how it was tackled in different research papers, how does it relate to the work done in this thesis and also how does it differ.
\paragraph{Chapter 3}
It is dedicated to the \glsreset{iot}\gls{iot}. It presents the topic, talks about the importance of \gls{iot}, its impact on the world, the actual Internet, the future of Internet and also how will \gls{sg} benefit from it.
\paragraph{Chapter 4}
It will present the architecture of the system and the test-bed. It will discuss the system from different aspects, and how were the two problems solved from the architectural aspect.
\paragraph{Chapter 5}
This chapter will mostly discuss the implementation system. It will start by presenting the hardware used in this project, then move to the technology enablers. Each component of the system will be discussed extensively and move to the integration of the components to form the test-bed.
\paragraph{Chapter 6}
It will start first by presenting the findings then move to explain the experiment that was done to measure the performance of the system. The data gathering section will show how and what data was gathered and then move to analyzing and interpreting the data.
\paragraph{Chapter 7, 8}
These are the last two chapters of the thesis that will conclude the thesis, provide directions about future work and recommendations to the reader what parts of the system could be ameliorated and how it can be achieved.
\chapter{Literature review}
\section{The need for Smart Grid}
\paragraph{}
The actual electrical grid is based on a technology that is at least one century old \cite{ref5}. As a result, there is a need to change as to meet to 21st century requirement such as having more green energy in order to reduce the pollution caused mainly by the use of fossil energy. As a result, research has introduced a new technology called \glsreset{sg}\gls{sg}. Although it is still a research project and numerous issues related to \gls{sg} are left unanswered, nations across the globe started to deploy \gls{sg} project. It is also noted that in order for the grid to become more reliable, secure and efficient, a bi-directional information and communication infrastructure should be embedded within the grid \cite{ref5}.
\paragraph{}
The smart grid brings around new concepts that will achieve efficiency, reliable and security to the power grid. The first one is the introduction of the \gls{dg} by exploiting \gls{res} \cite{ref6} and this reduce the losses of energy in the transmission.  This distribution by itself enables the power grid this to move from the one way energy distribution to a two-way energy distribution where the utility will not be the sole energy producer but households can now produce and even sell the extra power. This is known nowadays as the feed-in-tariff which is a policy that allows the consumers to become producer and sell the excess power to the grid \cite{ref7}. This will allow the power grid to provide power to consumer in a "free market" fashion which means that it will obey to the laws of supply and demand \cite{ref7}.\glsreset{iot} \glsreset{sg}
\section{\gls{iot} and \gls{sg}}
\paragraph{}
The \glsreset{iot}\gls{iot} has known high acceptance by the players in the Internet. Nowadays, it is estimated that 12.5 billion devices are connected to the Internet and that this trend will continue to read 50 billion connected devices by the end of the decade \cite{ref3}. \gls{iot} brings several benefits to the actual Internet and these benefits will pull \gls{sg} to be part of it. Consequently, research has taken this direction which is to integrate the \gls{sg} within the \gls{iot} as most aspects of \gls{sg} will be enhanced by \gls{iot} \cite{ref8}.
\paragraph{}
\gls{iot} counts on a set of technologies which are \glsreset{rfid}\gls{rfid}, \gls{m2m} \cite{ref9}, public communication networks such as 2G/3G mobile networks, power lines, WI-FI, Zigbee and other technologies \cite{ref8}. The smart grid's architecture based on \gls{iot} will be divided into three layers:
\begin{itemize}
\item Perception layer: Devices will autonomously perform their tasks such as sensing and executing orders.
\item Communication layer: The communication infrastructure is defined here and issues related to how to communicate information is handled.
\item Application layer: Applications can be built to make use of the underlying data.
\end{itemize}
\paragraph{}
Some of the research is discussing the need to replace Zigbee by Wi-Fi as the Wi-Fi offers higher bandwidth, non-line transmission ability, large-scale data collection and is highly cost-effective \cite{ref10} but still Zigbee has the sole advantage of very low energy consumption which is something required in \gls{sg} and \gls{iot}, because in systems that are installed far away from any maintenance team such as smart grid monitoring and self-healing devices, one cannot manage to move for the sole purpose of providing energy often. 
\paragraph{}
From the architectural point of view, integrating \gls{sg} within \gls{iot} means having to address heterogeneity issues. An \gls{iot} gateway system that is based on Zigbee and GPRS protocols \cite{ref11}. This enables then to deal partly with the heterogeneity problem and therefore enable the \gls{wsn} to communicate with the mobile telecommunication network. Another solution to the heterogeneity problem is proposed where the solution is to present a new, light-weight web service transport protocol called Lean Transport Protocol (LTP) that will allow transparent exchange of web service messages between all kinds of devices \cite{ref12}. This protocol is platform-independent, low energy consumer. Some researchers claim that the heterogeneity is mainly coming from the fact that there are different \gls{wsn} devices that do not necessarily use the same standards and protocols. They propose to move all the \glspl{wsn} to all-IP networks as this would remove most of the heterogeneity but there are already deployed legacy \glspl{wsn} \cite{ref13}. They sketch an architecture capable of converting all the \glspl{wsn}, new and legacy, to support \gls{ipv6}.\glsreset{sg}
\section{The \gls{sg} two-way communication}
\paragraph{}

\chapter{Internet Of Things}


\section{The actual Internet}
\section{Introduction to \gls{iot}}
\section{Importance of \gls{iot}}
\section{The impact of \gls{iot}}
\section{The benefits of \gls{iot}}
\section{The future of Internet}


\chapter{System Architecture}
\paragraph{}
The thesis is based on the study and creation of a test-bed system whose goal is to integrate smart home with the \glsreset{sg}\gls{sg} and all within the \glsreset{iot}\gls{iot}. To do so, we first define the system's objectives and goals which do align  with the thesis's problem statement and purpose of study. Then each part of the system is presented, and a section of this chapter is dedicated to each part explaining the architecture of each component and how it aligns and integrates with the whole system.
\section{System objectives}
\paragraph{Objective 1}
The goal of the system is to present a working test-bed that is able to interact with any appliance in the smart home. The system makes this possible by making all appliances part of the \glsreset{wsn}\gls{wsn} where each sensor node is addressable and may be used to control the appliance.
\paragraph{Objective 2}
Another system objective is to be able to monitor in real-time the consumption of each appliance and send this to a central repository where this data is to be stored. This will enable the sensor node to keep track of the appliance it is controlling and monitoring and collect consumption data that is sent and stored in a \gls{rdbms}.
\paragraph{Objective 3}
The third objective is to make this system hide its heterogeneity from the outside world and also from different component belonging to it. This means that the system should be able to make any two components communicate independently of the technology they are using and also making each component think the other is using the same technology as his. 

\section{Division of components}
\paragraph{}
The system is divided into nine components where every component is in charge of a part of the system's objectives. When these nine components work hand-in-hand, they achieve all the system's and project's objectives and goals. The components that are defined for this system are the following:

\begin{itemize}
\item Full \gls{ipv6} \glsreset{wsn}\gls{wsn}
\item Mote sensor data collection TCP client
\item Mote appliance control TCP server
\item Gateway packet transformation process
\item \gls{ipv6} over USB tunnel
\item mote \gls{ipv6} backstation
\item Sensor data storage process
\item HTTP sensor data sender
\item Mobile client
\end{itemize}

\section{General architecture of the system}
\paragraph{}
The general architecture is depicted in figure \ref{fig:gen_architecture}. This figure shows the different components of the system and their interactions. Each set of components is appearing within a box and that box is labeled. This label refers to the hardware deployment of the component within the whole system.
\begin{figure}[htbp]
\centering
\includegraphics[scale=0.40]{img/general_architecture.jpg}
\caption{General architecture depicting the main components of the system}
\label{fig:gen_architecture}
\end{figure}
\paragraph{}
Now that the general architecture has been defined, the question that should be asked is whether all these components reside in the same layer in the \gls{osi} model and if not, in which layer does each of these components reside in the \gls{osi} model. As an answer to such a question, figure \ref{fig:layered_view} is here to show on what layer does every component act on.

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.40]{img/layered_view.jpg}
\caption{Layered view showing where every component appears in the \gls{osi} model}
\label{fig:layered_view}
\end{figure}
\paragraph{}
From figure \ref{fig:layered_view}, one can see that there are three components in performing in the data link layer and network layer. The first one is the packet transformation process whose goal is to hide the communication heterogeneity by sniffing incoming packets, transforming them, and forwarding them to the destination to meet the destination's communication technology and standards used. The second component performing in the data link layer and network is the \gls{ipv6} over USB tunnel. This component is in charge of getting raw \gls{ipv6} packets and encapsulate them through USB to reach the destination. The third component is deployed in the mote sink which is the entry and exit point of the \gls{wsn}. This special mote receives \gls{ipv6} packets encapsulated in USB frames that are forwarded to the destination mote using Zigbee.

\paragraph{}
There are four components that perform in the session layer, presentation layer and application layer and are existing in most of the devices needed in the system. The first one is the client mobile App. This component is mostly a TCP client and uses many of the services provided by the layers it is performing on. The second component is the sensor data storage which is a TCP server receiving data from the \gls{wsn} and sending storing it in a \gls{rdbms}. The third and fourth components are the Mote TCP client and Mote TCP server that send sensor data and through the TCP client and receive orders to control the appliance using the TCP server. 
\paragraph{}
The only component acting in the application layer exclusively is the HTTP sensor data sender which provides a gateway to other applications willing to use such data and later on make use of the system. This component receives data and sends to the destination by using HTTP protocol. The middleware application was using HTTP to get sensor data from this system.
\paragraph{}
Now that the general structure of the software system has been established, the hardware structure is to be presented and explained further. figure \ref{fig:network_diagram} is a network diagram that shows the of the hardware components that exist within this system. The \glsreset{wsn}\gls{wsn} appears on the right of the document. Attached to it a mote sink that exist both in the \gls{wsn} and outside it. This mote sink is attached to the gateway server through USB. The gateway has also a Wi-Fi interface card that enables it to communicate with the other parts of the system such as the middleware and the mobile client.

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.8]{img/network_diagram.jpg}
\caption{Network diagram of the system}
\label{fig:network_diagram}
\end{figure}
\paragraph{}
Now that the network diagram has been established in \ref{fig:network_diagram} where the hardware component appears, the next thing is to show where each software component will be deployed. In other words, what are the software components that exist on which hardware machine. This is the goal of table \ref{table:soft_hard_deployment}. It clearly shows what software components exist in what hardware. From the table \ref{table:soft_hard_deployment}, it is clear that there are hardware machines that have more than one component deployed and this is also the case for small devices such as sensor nodes within the \gls{wsn}.

\begin{table}
    \begin{tabular}{lllll}
    		  \hline
    Software component - Hardware component & Mote & Mote sink & Gateway & Mobile \\ \hline
    Mote sensor data collection TCP client  & X    & X         & ~       & ~      \\ 
    Mote appliance control TCP server       & X    & X         & ~       & ~      \\
    Gateway packet transformation process   & ~    & ~         & X       & ~      \\
    IPv6 over USB tunnel                    & ~    & ~         & X       & ~      \\
    Mote IPv6 backstation                   & ~    & X         & ~       & ~      \\
    Sensor data storage process             & ~    & ~         & X       & ~      \\
    HTTP sensor data sender                 & ~    & ~         & X       & ~      \\
    Mobile client                           & ~    & ~         & ~       & X      \\
    \end{tabular}
    \caption{Software-hardware deployment table}
    \label{table:soft_hard_deployment}
\end{table}
\paragraph{}
In the following sections, each software component will be described in more details showing why such a component is crucial and what are the architectural decisions made to be what it is.

\section{Mote sensor data collection TCP client}
The mote sensor data collection TCP client is nothing mote but a \gls{tcp} client deployed in a mote that is attached to an appliance that reads sensor data periodically from the consumption sensor more known as the \gls{ct}  as showns in figure \ref{fig:current_transformer} that returns after a few transformations of the data the exact amount of power consumer in \gls{wh}. The original amount returned a voltage value in \gls{v} that is then transformed into the electric intensity in \gls{a}. To transform, the voltage into the actual current intensity we make use of the data provided by the \gls{ct} manufacturer. By making use of an experiment whose goals is to measure the slope and the constant of the voltage to intensity function. This function resulted in the following values:

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.8]{img/ct.jpg}
\caption{Current transformer}
\label{fig:current_transformer}
\end{figure}

\begin{table}
    \begin{tabular}{ll}
    \hline
    slope    & 66.7 \gls{a} \\ \hline
    Constant & 0 \gls{a}    \\ \hline
    \end{tabular}
    \caption{Current Transformer values}
        \label{table:CT_vals}
\end{table}
The transformation function is then: \\
\boldmath{$I = 66.7U_0$} \\
I: Intensity in \glsreset{a}\gls{a} \\
$U_0$: The voltage read from the \gls{ct}

\paragraph{}
Afterwards, as the voltage in Moroccan households is 220 \gls{v} we get the power using the following function:
\\
\boldmath{$ P = U_1 I $} \\
P: Power in \gls{w} \\
I: Intensity in \glsreset{a}\gls{a} \\
$U_1$: Electrical potential difference or Voltage in household in \glsreset{v}\gls{v}
\paragraph{}
P refers to the power, not the actual consumption of the appliance. To get the consumption we use an additional parameter which is the sampling rate. The sampling rate is defined as the number of sensor reading actions per hour. If one reads sensor data every second, then the sampling rate is 3600 samples per second.
\paragraph{}
To find the actual consumption, we need to consecutive sensor readings that we call $P_0$ and $P_1$ and use the following function:
\\
$ C = \cfrac{P_0 + \cfrac{P_1 - P_0}{2}}{S} $ \\
C: Current Consumption in \glsreset{wh}\gls{wh} \\
P: Power sample number 1 in \glsreset{w}\gls{w} \\
P': Power sample number 2 in \glsreset{w}\gls{w} \\
$U_1$: Electrical potential difference or Voltage in households in \glsreset{v}\gls{v} \\
S: Sampling rate \\
The assumption taken is that if the power varies between two consecutive samples, the change was made linear throughout the interval of time between the two.
\paragraph{}
Once the consumption data in hand after this series of transformation, the next thing left to do is to send this data. To send it, the mote make use of the \gls{tcp}  client built on top of \gls{blip} package that implements the TCP/IP protocol stack. The system is made in a way that all the sensor data is sent to the gateway services that will decide to store it in a data store or send it to another system outside of the scope of this project.

\chapter{Implementation}

\chapter{Findings}
\section{Experiment}
%\subsection{Methodology}
\section{Data gathering}
\section{Interpretation of result}

\chapter{Conclusion}

\chapter{Future Work}

\appendix
\chapter{How to install the system}
\chapter{TinyOs program}
\chapter{6to4/4to6 packet transformation}

\backmatter

\singlespacing
\printglossaries
\bibliographystyle{IEEEtran} 
\bibliography{IEEEabrv,myrefs}

\end{document}